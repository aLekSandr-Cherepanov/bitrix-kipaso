$(function(){var l=!1;$(document).on("click",".elementSkuDropDownProperty .skuCheckedItem",function(e){var a=$(this).siblings(".skuDropdownList");return a.toggleClass("opened"),skuDropdownOpened=a.hasClass("opened"),e.preventDefault()}),$(document).on("click",".elementSkuDropDownProperty .skuDropdownListItem",function(e){var a=$(this),t=a.parents(".skuDropdownList"),s=(t.find(".skuDropdownListItem").removeClass("selected"),t.siblings(".skuCheckedItem"));return t.removeClass("opened"),skuDropdownOpened=!1,a.addClass("selected"),s.html(a.text()),e.preventDefault()}),$(document).on("click",".skuDropdown",function(e){e.stopImmediatePropagation()}),$(document).on("click",function(e){skuDropdownOpened&&($(".skuDropdownList").removeClass("opened"),skuDropdownOpened=!1)}),$(document).on("click",".elementSkuPropertyLink",function(e,a){if(1==l&&void 0===a)return!1;var O,t,D,s,S,I,n,d="",i="",r="",a="",o=$(this);o.parent().hasClass("selected")||(O=o.parents(".elementSku"),t=o.parents(".item"),n=o.parents(".elementSkuProperty"),D=O.find(".elementSkuProperty"),s=o.parents(".elementSkuPropertyValue"),S=O.find(".fastBack").removeClass("disabled"),I=n.data("level"),o.parents(".elementSkuPropertyList").find("li").removeClass("selected"),s.addClass("selected loading"),$("#catalogElement").addClass("loading"),l=!0,D.each(function(e,a){var a=$(a),t=a.find("li"),s=a.data("name"),n=!1;"Y"==a.data("highload")&&(r=r+s+";"),t.each(function(e,a){a=$(a);if(i=i+s+":"+a.data("value")+";",a.hasClass("selected"))return d=d+s+":"+a.data("value")+";",n=!0}),n||(d=d+s+":-forse;")}),"undefined"!=typeof elementStoresComponentParams&&(a=JSON.stringify(elementStoresComponentParams)),n={act:"selectSku",props:i,params:d,level:I,iblock_id:O.data("iblock-id"),prop_id:O.data("prop-id"),product_id:O.data("product-id"),highload:r,"price-code":t.data("price-code"),stores_params:a,deactivated:O.data("deactivated")},"undefined"!=typeof SITE_ID&&""!=SITE_ID&&(n.siteId=SITE_ID),"undefined"!=typeof countTopProperties&&""!=countTopProperties&&(n.countProperties=countTopProperties),"object"!=typeof catalogVariables||$.isEmptyObject(catalogVariables)||(n.catalogVariables=catalogVariables),"object"!=typeof sectionPathList||$.isEmptyObject(sectionPathList)||(n.sectionPathList=sectionPathList),"object"!=typeof lastSection||$.isEmptyObject(lastSection)||(n.lastSection=lastSection),"undefined"!=typeof disableWeight&&""!=disableWeight&&(n.disableWeight=disableWeight),"undefined"!=typeof disableDimensions&&""!=disableDimensions&&(n.disableDimensions=disableDimensions),$.ajax({url:elementAjaxPath,type:"POST",async:!0,cache:!1,data:n,dataType:"json",success:function(e){D.each(function(e,a){a=$(a);a.data("level")>I&&a.find(".elementSkuPropertyValue").removeClass("selected").addClass("disabled")}),$.each(e[1].PROPERTIES,function(e,s){D.filter(function(){return $(this).data("name")==e}).find(".elementSkuPropertyValue").each(function(e,a){var t=$(a);$.each(s,function(e,a){if(e==t.data("value")&&"D"!=a)return"Y"==a?t.addClass("selected").removeClass("disabled").trigger("click"):t.removeClass("disabled"),!1})})});var s=0;if(e[0].PRODUCT.IMAGES){for(var a in e[0].PRODUCT.IMAGES)s=a;var n=$("#pictureContainer .pictureSlider").empty(),d=$("#moreImagesCarousel").removeClass("hide"),i=d.find(".slideBox");i.find(".item").remove(),$.each(e[0].PRODUCT.IMAGES,function(e,a){var t=$("<img />",{src:a.MEDIUM_IMAGE.SRC});n.append($("<div />",{class:"item"}).append($("<a/>",{class:"zoom",href:a.LARGE_IMAGE.SRC}).data("large-picture",a.LARGE_IMAGE.SRC).data("small-picture",a.SMALL_IMAGE.SRC).append(t))),0<s?i.append($("<div />",{class:"item"}).append($("<a/>",{class:"zoom",href:a.LARGE_IMAGE.SRC}).data("large-picture",a.LARGE_IMAGE.SRC).append($("<img />",{src:a.SMALL_IMAGE.SRC})))):d.addClass("hide")}),changeAddCartButton(basketProductsNow),subscribeOnline(),startPictureElementSlider(),startMorePicturesElementCarousel(),createZoomer()}O.find(".changeID").data("id",e[0].PRODUCT.ID).attr("data-id",e[0].PRODUCT.ID),O.find(".changePicture").html($("<img/>").attr("src",e[0].PRODUCT.IMAGES[0].MEDIUM_IMAGE.SRC)),O.find(".changePropertiesNoGroup").html(e[0].PRODUCT.RESULT_PROPERTIES_NO_GROUP),O.find(".changePropertiesGroup").html(e[0].PRODUCT.RESULT_PROPERTIES_GROUP);var t=O.find(".changeCart").removeClass("subscribe unSubscribe");t.find("img").remove(),(e[0].PRODUCT.PRICE.DISCOUNT_PRICE?t.removeClass("added").removeClass("disabled").removeClass("requestPrice").html($("<span />").html(LANG.ADD_BASKET_DEFAULT_LABEL).prepend($("<img />").attr({src:TEMPLATE_PATH+"/images/incart.svg",class:"icon"}))):(S.addClass("disabled"),t.removeClass("added").addClass("disabled").addClass("requestPrice").html($("<span />").html(LANG.REQUEST_PRICE_BUTTON_LABEL).prepend($("<img />").attr({src:TEMPLATE_PATH+"/images/request.svg",class:"icon"}))))).attr("href","#");var r=O.find(".eChangeAvailable");r.removeClass("getStoresWindow"),r.removeClass("outOfStock"),r.removeClass("onOrder"),r.removeClass("inStock"),r.removeAttr("href"),e[0].PRODUCT.PRICE.DISCOUNT_PRICE?(T=O.find(".changePrice").empty().removeClass("getPricesWindow").removeClass("requestPrice").removeAttr("href").data("id",e[0].PRODUCT.ID),o=$("<span/>",{class:"priceVal"}).html(e[0].PRODUCT.PRICE.DISCOUNT_PRICE),l=$("<span/>",{class:"priceContainer"}).html(o)):(T=O.find(".changePrice").empty().removeClass("getPricesWindow").removeAttr("href").addClass("requestPrice").addClass("disabled").data("id",e[0].PRODUCT.ID),o=$("<span/>",{class:"priceVal"}).html(LANG.REQUEST_PRICE_LABEL),l=$("<span/>",{class:"priceContainer"}).html(o),e[0].PRODUCT.CAN_BUY="N");T.find(".purchaseBonus").remove(),e[0].PRODUCT.RESULT_PROPERTIES&&$product.find(".changeProperties").html(e[0].PRODUCT.RESULT_PROPERTIES);1<e[0].PRODUCT.COUNT_PRICES&&(l.prepend($("<span/>",{class:"priceIcon"})),T.addClass("getPricesWindow").attr("href","#"));T.html(l),0<e[0].PRODUCT.CATALOG_QUANTITY?(1<e[0].PRODUCT.STORES_COUNT?r.html($("<span/>").html(LANG.CATALOG_AVAILABLE)).addClass("inStock").attr("href","#").addClass("getStoresWindow").data("id",e[0].PRODUCT.ID):r.html(LANG.CATALOG_AVAILABLE).addClass("inStock"),r.prepend($("<img/>").addClass("icon").attr("src",TEMPLATE_PATH+"/images/inStock.svg"))):"Y"!=e[0].PRODUCT.CAN_BUY?(r.html(LANG.CATALOG_NO_AVAILABLE).addClass("outOfStock"),S.addClass("disabled"),"Y"==e[0].PRODUCT.CATALOG_SUBSCRIBE&&e[0].PRODUCT.PRICE.DISCOUNT_PRICE?t.html($("<span />").html(LANG.ADD_SUBSCRIBE_LABEL).prepend($("<img />").attr({src:TEMPLATE_PATH+"/images/subscribe.svg",class:"icon"}))).attr("href","#").addClass("subscribe"):t.addClass("disabled"),r.prepend($("<img/>").addClass("icon").attr("src",TEMPLATE_PATH+"/images/outOfStock.svg"))):(r.html(LANG.CATALOG_ON_ORDER).addClass("onOrder"),r.prepend($("<img/>").addClass("icon").attr("src",TEMPLATE_PATH+"/images/onOrder.svg")));var o=O.find(".qtyBlock .qty");o.val(e[0].PRODUCT.BASKET_STEP).data("max-quantity",e[0].PRODUCT.CATALOG_QUANTITY).data("step",e[0].PRODUCT.BASKET_STEP).removeClass("error"),o.removeAttr("data-extended-price").removeData("extended-price"),t.data("quantity",e[0].PRODUCT.BASKET_STEP),void 0===e[0].PRODUCT.PRICE.EXTENDED_PRICES_JSON_DATA||""!=e[0].PRODUCT.PRICE.EXTENDED_PRICES_JSON_DATA&&o.data("extended-price",e[0].PRODUCT.PRICE.EXTENDED_PRICES_JSON_DATA);"Y"==e[0].PRODUCT.CATALOG_QUANTITY_TRACE&&"N"==e[0].PRODUCT.CATALOG_CAN_BUY_ZERO?o.data("enable-trace","Y"):o.data("enable-trace","N");BX.onCustomEvent(window,"onCatalogStoreProductChange",[e[0].PRODUCT.ID]);var l=O.find('.changeTabs .tab[data-id="stores"]').removeClass("active disabled");void 0!==e[0].PRODUCT.STORES_COMPONENT&&""!=e[0].PRODUCT.STORES_COMPONENT?$("div").is("#storesContainer")&&($("#storesContainer").html(e[0].PRODUCT.STORES_COMPONENT),"function"==typeof startElementTabs)&&startElementTabs():($("#storesContainer").html(""),l.addClass("disabled"),"function"==typeof startElementTabs&&startElementTabs());void 0!==e[0].PRODUCT.PREVIEW_TEXT&&""!=e[0].PRODUCT.PREVIEW_TEXT?O.find(".changeShortDescription").html(e[0].PRODUCT.PREVIEW_TEXT):O.find(".changeShortDescription").html("");void 0!==e[0].PRODUCT.DETAIL_TEXT&&""!=e[0].PRODUCT.DETAIL_TEXT?O.find(".changeDescription").html(e[0].PRODUCT.DETAIL_TEXT):O.find(".changeDescription").html("");void 0!==e[0].PRODUCT.PROPERTIES.CML2_ARTICLE&&(void 0!==e[0].PRODUCT.PROPERTIES.CML2_ARTICLE.VALUE&&""!=e[0].PRODUCT.PROPERTIES.CML2_ARTICLE.VALUE?O.find(".changeArticle").html(e[0].PRODUCT.PROPERTIES.CML2_ARTICLE.VALUE).parents(".article").removeClass("hidden"):O.find(".changeArticle").data("first-value")?O.find(".changeArticle").html(O.find(".changeArticle").data("first-value")):O.find(".changeArticle").parents(".article").addClass("hidden"));e[0].PRODUCT.PRICE.DISCOUNT_PRICE&&"Y"!=O.data("hide-measure")&&null!=e[0].PRODUCT.MEASURE&&""!=e[0].PRODUCT.MEASURE.SYMBOL_RUS&&T.append($("<span/>").addClass("measure").html(" / "+e[0].PRODUCT.MEASURE.SYMBOL_RUS+" "));0<e[0].PRODUCT.PRICE.RESULT_PRICE.DISCOUNT&&(($productPriceBlock=$("<span/>",{class:"priceBlock"})).append($("<span/>").addClass("oldPriceLabel").html($("<s/>").addClass("discount").html(e[0].PRODUCT.PRICE.RESULT_PRICE.BASE_PRICE))),$productPriceBlock.append($("<span/>").addClass("oldPriceLabel").html(" &nbsp; "+LANG.CATALOG_ECONOMY).append($("<span/>").addClass("economy").html(e[0].PRODUCT.PRICE.DISCOUNT_PRINT))),T.prepend($productPriceBlock));void 0!==e[0].PRODUCT.PROPERTIES.BONUS&&""!=e[0].PRODUCT.PROPERTIES.BONUS.VALUE&&(r=$("<span />",{class:"purchaseBonus"}).html(e[0].PRODUCT.PROPERTIES.BONUS.NAME),t=$("<span />",{class:"theme-color"}).html("+ "+e[0].PRODUCT.PROPERTIES.BONUS.VALUE),r.prepend(t),T.append(r));{var c,C,P,E;$("div").is("#set")&&(o=$(".changePriceSet").html(e[0].PRODUCT.PRICE.DISCOUNT_PRICE),0<e[0].PRODUCT.PRICE.RESULT_PRICE.DISCOUNT&&o.append($("<s/>").addClass("discount").html(e[0].PRODUCT.PRICE.RESULT_PRICE.BASE_PRICE)),l=$("#set"),t=l.find('.setMainElement:not(".disabled")'),T=$("#setPrice"),r=$("#setDisnt"),C=c=0,P=T.html().replace(/[0-9]/g,""),E=r.html().replace(/[0-9]/g,""),m=parseInt(e[0].PRODUCT.PRICE.RESULT_PRICE.DISCOUNT_PRICE),l.find(".general.setElement").data("price",m).data("discount",e[0].PRODUCT.PRICE.RESULT_PRICE.DISCOUNT_PRICE),t.each(function(e,a){a=$(a);c+=parseInt(a.data("price")),C+=parseInt(a.data("price"))+parseInt(a.data("discount"))}),T.html(formatPrice(c)+P),r.html(formatPrice(C)+E),0==C?r.hide():r.show())}{var T,p,R,m;$("div").is("#setWindow")&&(o=$("#setWindow"),l=o.find('.setWindowElement:not(".disabled")'),t=$("#setWPrice"),T=$("#setWDisnt"),R=p=0,t.html().replace(/[0-9]/g,""),T.html().replace(/[0-9]/g,""),m=parseInt(e[0].PRODUCT.PRICE.DISCOUNT_PRICE.replace(/[^0-9]/g,"")),o.find("#wProduct").data("price",m).data("discount",e[0].PRODUCT.PRICE.RESULT_PRICE.DISCOUNT),l.each(function(e,a){a=$(a);p+=parseInt(a.data("price")),R+=parseInt(a.data("price"))+parseInt(a.data("discount"))}),t.html(formatPrice(p)+P),T.html(formatPrice(R)+E),0==R?T.hide():T.show())}$(".changeName").html(e[0].PRODUCT.NAME),$(".cheaper-product-name").html(e[0].PRODUCT.NAME),0<$(".fast-deliveries-container").html("").length&&"Y"==e[0].PRODUCT.CAN_BUY&&"function"==typeof $.getDeliveryComponent&&$.getDeliveryComponent(e[0].PRODUCT.ID,e[0].PRODUCT.BASKET_STEP,e[0].PRODUCT.CAN_BUY,"Y")},complete:function(){s.removeClass("loading"),O.removeClass("loading"),l=!1}})),e.preventDefault()})});